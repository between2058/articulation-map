# Phidias 關節定義指南

本文件說明 Phidias 編輯器中的語意標籤（Semantic Tags）、物理屬性（Physics Properties）與關節（Joints）設定項目。

---

## 目錄

1.  [零件標籤與屬性](#零件標籤與屬性)
    - [類型 (Type)](#類型-type)
    - [角色 (Role)](#角色-role)
    - [活動性 (Mobility)](#活動性-mobility)
    - [質量屬性 (Mass)](#質量屬性-mass)
    - [碰撞設定 (Collision)](#碰撞設定-collision)
    - [物理材質 (Material)](#物理材質-material)
2.  [關節定義](#關節定義)
    - [關節類型](#關節類型)
    - [錨點 (Anchor)](#錨點-anchor)
    - [限制與驅動 (Limits & Drives)](#限制與驅動-limits--drives)
    - [碰撞過濾 (Filtering)](#碰撞過濾-filtering)
3.  [實際範例](#實際範例)

---

## 零件標籤與屬性

### 類型 (Type)

**用途：** 標記這個零件在機器人中扮演的結構角色。

| 類型 | 英文 | 說明 | 重要性 |
|------|------|------|--------|
| **基座** | `base` | 固定在世界座標的根部零件 | ⭐ 每個模型必須有一個 |
| **連桿** | `link` | 可動的剛體零件 | 機器人的主要組成 |
| **工具** | `tool` | 末端執行器 (Gripper) | |
| **關節** | `joint` | 連接點標記（較少使用） | |

---

### 角色 (Role)

**用途：** 描述零件的功能用途（僅供參考，不影響物理）。

- `actuator` (驅動器), `support` (支撐件), `gripper` (夾爪), `sensor` (感測器), `other` (其他)

---

### 活動性 (Mobility)

**用途：** 描述這個零件如何移動。

- `fixed` (固定): 與父件完全鎖定。
- `revolute` (旋轉): 繞軸旋轉。
- `prismatic` (滑動): 沿軸移動。

---

### 質量屬性 (Mass)

**用途：** 定義物體的重量與慣量，影響模擬的真實度。

| 模式 | 說明 | 範例 |
|------|------|------|
| **Auto (Density)** | 根據體積與密度自動計算 | 水=1000, 鋁=2700, 鋼=7800 (kg/m³) |
| **Manual (Mass)** | 直接指定重量 (kg) | 馬達重 0.5 kg |

---

### 碰撞設定 (Collision)

**用途：** 定義物體的碰撞外形。精確的碰撞計算非常耗費效能，因此通常使用簡化形狀。

| 類型 | 說明 | 適用情境 |
|------|------|----------|
| **Convex Hull** | 凸包（預設）。像是用保鮮膜把物體包起來。 | 大多數零件。快速且穩定。 |
| **Mesh** | 三角網格。與視覺模型完全一致。 | 極少使用，除非形狀非常特殊且需高精度。 |
| **Decomposition** | 凸包分解。將凹物體切成多個凸包。 | 杯子、碗、U型槽等凹陷物體。 |
| **None** | 無碰撞。 | 裝飾品、光線、標記點。 |

---

### 物理材質 (Material)

**用途：** 定義表面的摩擦力與彈性。

| 參數 | 範圍 | 說明 | 範例 |
|------|------|------|------|
| **靜摩擦 (Static)** | 0.0 ~ 1.0+ | 推動它開始移動的難度 | 橡膠=0.9, 冰=0.1 |
| **動摩擦 (Dynamic)** | 0.0 ~ 1.0+ | 移動中持續滑動的阻力 | 塑膠=0.4, 金屬=0.3 |
| **彈性 (Restitution)** | 0.0 ~ 1.0 | 彈跳程度 | 橡皮球=0.8, 黏土=0.0 |

---

## 關節定義

關節定義了兩個零件（Parent -> Child）之間的運動關係。

### 關節類型

| 類型 | 示意 | 用途 |
|------|------|------|
| **Revolute** | 🔄 | 轉動（門軸、輪子、馬達） |
| **Prismatic** | ↔️ | 滑動（抽屜、升降梯、夾爪） |
| **Fixed** | 🔒 | 鎖定（焊接、螺絲固定） |

### 錨點 (Anchor) 📍

**定義：** 關節旋轉或滑動的**中心點**。
*   座標是相對於 **Child (子件)** 的局部座標。
*   在 3D 視圖中會顯示為 **黃色球體** 與 **紅色軸向箭頭**。
*   若錨點位置錯誤，關節轉動時會像「脫臼」一樣亂甩。

### 限制與驅動 (Limits & Drives)

設定關節的運動範圍與動力來源。

#### 1. Limits (限制)
*   **Lower / Upper**: 限制最小與最大角度（度）或距離（米）。
*   例如：手肘只能彎 0° ~ 150°。

#### 2. Drives (驅動器/馬達)
*   **Stiffness (剛度)**: P控制器的 P 值。越大越硬，能準確維持位置。
*   **Damping (阻尼)**: P控制器的 D 值。防止震盪，使運動平滑。
*   **Max Force**: 馬達最大能輸出的力矩或推力。

### 碰撞過濾 (Filtering) ⚠️

*   選項：**Disable Collision with Parent** (預設開啟)。
*   **功能**：忽略 Parent 與 Child 之間的碰撞偵測。
*   **為什麼重要？** 關節連接處通常模型會有重疊（Overlap）。如果沒開啟此選項，模擬引擎會認為兩者發生劇烈碰撞，導致機器人瞬間「爆炸」或劇烈抖動。

---

## 實際範例

### 範例：輪式機器人 (AGV)

**1. 輪子設定 (Link)**
*   **Tags**: Type=`link`, Role=`actuator`, Mobility=`revolute`
*   **Mass**: Density=1200 (橡膠輪)
*   **Collision**: Convex Hull
*   **Material**: Static/Dynamic Friction=0.9 (高摩擦力，避免打滑)

**2. 輪軸關節 (Joint)**
*   **Type**: Revolute
*   **Anchor**: 調整至輪子圓心
*   **Axis**: Y 軸 (假設輪子側面朝 Y)
*   **Limits**: 無限制 ( -inf ~ +inf )，因為輪子要轉很多圈
*   **Drive**: 
    *   Stiffness=0 (輪子是速度控制，不需位置剛度)
    *   Damping=1000 (模擬摩擦阻力)
    *   Drive Type=Velocity (速度控制)
*   **Filtering**: Disable Collision = CHECKED

---

### 範例：精密夾爪 (Gripper)

**1. 夾爪指頭 (Link)**
*   **Tags**: Type=`tool`, Role=`gripper`, Mobility=`prismatic`
*   **Material**: Friction=1.0 (極高摩擦力，才能抓穩東西)

**2. 滑動軌道 (Joint)**
*   **Type**: Prismatic (滑動)
*   **Limits**: 0.0m ~ 0.05m (只能開合 5 公分)
*   **Drive**: 
    *   Stiffness=10000 (這種需要很硬，位置要很準)
    *   Damping=500
    *   Drive Type=Position (位置控制)

---

## 常見問題 (FAQ)

### Q: 為什麼輪子在地上空轉跑不動？
**A:** 檢查 **Physics Material**。預設摩擦力 (0.5) 可能不夠，試著調高到 0.9 或 1.0。另外檢查輪子是否有接觸地面。

### Q: 機器人一開始模擬就往天上飛或散架？
**A:** 檢查 **Collision Filtering**。確保所有關節都勾選了 "Disable Collision with Parent"。

### Q: 關節軟趴趴的撐不住重量？
**A:** 增加 **Drive Stiffness**。對於金屬機器人，剛度通常需要 10000 甚至 100000 以上。
